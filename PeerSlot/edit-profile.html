<!DOCTYPE html>
<html>
<head>
  <title>Edit Profile</title>
</head>
<body>

<h2>Edit Profile</h2>

<input id="name" placeholder="Full Name">
<input id="reg" placeholder="Registration No">
<input id="branch" placeholder="Branch">
<input id="sem" placeholder="Semester">
<textarea id="bio" placeholder="Short bio"></textarea>

<br>
<button onclick="updateProfile()">Save Changes</button>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Load existing data
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const snap = await getDoc(doc(db, "users", user.uid));
  if (!snap.exists()) {
    window.location.href = "setup.html";
    return;
  }

  const data = snap.data();

  document.getElementById("name").value = data.name || "";
  document.getElementById("reg").value = data.reg || "";
  document.getElementById("branch").value = data.branch || "";
  document.getElementById("sem").value = data.sem || "";
  document.getElementById("bio").value = data.bio || "";
});

// Save updated data
window.updateProfile = async () => {
  const user = auth.currentUser;

  await updateDoc(doc(db, "users", user.uid), {
    name: name.value,
    reg: reg.value,
    branch: branch.value,
    sem: sem.value,
    bio: bio.value
  });

  alert("Profile updated!");
  window.location.href = "profile.html";
};
</script>

</body>
</html>
