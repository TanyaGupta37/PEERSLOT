<!DOCTYPE html>
<html>
<head>
  <title>Login - PeerSlot</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="auth-page">
  <div class="auth-left">
    <h1>PeerSlot</h1>
  </div>

  <div class="auth-right">
    <div class="auth-box">
      <h2>Login</h2>

      <div class="field">
        <label>Email (MUJ)</label>
        <input id="email" placeholder="name.regno@muj.manipal.edu">
      </div>

      <div class="field">
        <label>Password</label>
        <input id="password" type="password">
      </div>

      <button onclick="login()">Login</button>

      <p>Don't have an account? <a href="signup.html">Sign up</a></p>
    </div>
  </div>
</div>

<script type="module">
import { auth } from "./firebase.js";
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

window.login = async () => {
  const emailVal = email.value.trim();
  const pass = password.value;

  const mujRegex = /^[a-zA-Z0-9._]+@muj\.manipal\.edu$/i;
  if (!mujRegex.test(emailVal)) {
    alert("Use your MUJ Outlook ID only");
    return;
  }

  const userCred = await signInWithEmailAndPassword(auth, emailVal, pass);

  if (!userCred.user.emailVerified) {
    alert("Verify your email first!");
    return;
  }

  location.href = "dashboard.html";
};
</script>

</body>
</html>
